---
title: "Take-home_Ex01"
author: "Vivian Fan Jing"
date: "February 16, 2025"
execute:
  warning: false
---

# 1.Getting started

## 1.1 Installing and loading the required libraries

```{r}
pacman::p_load(ggiraph,plotly,patchwork, ggdist, 
               ggridges, ggthemes, colorspace, tidyverse,ggplot2, ggExtra)
```

## 1.2 Importing data

For the purpose of this exercise, a data file called japan_heart_attack_dataset will be used. It consists of 30,000 observations. It is in csv file format.

```{r}
heart_data <- read_csv("data/japan_heart_attack_dataset.csv")
```

There are a total of seven attributes in the heart_data tibble data frame. Ten of them are categorical data type and the other seven are in continuous data type.

-   The categorical attributes are: Gender, Region, Smoking_History(Binary), Diabetes_History(Binary), Hypertension_History(Binary), Physical_Activity, Diet_Quality, Alcohol_Consumption, Family_History(Binary),Heart_Attack_Occurrence(Binary)

-   The continuous attributes are: Age, Cholesterol_Level, Stress_Levels, BMI, Heart_Rate, Systolic_BP, Diastolic_BP

# 2 Understanding the Data

Heart attack is the leading cause of death in the world. Heart attacks are mostly caused by your lifestyle. Do you smoke? Do you exercise? Do you eat right? Are you overweight? Do you keep your blood pressure under control? heart disease incorporates your family history.

## 2.1 Reviewing the dataset to understand Demographics Variables

### 2.1.1 Distribution and relationships involving Age

```{r}
ggplot(heart_data, aes(x = Age, fill = Heart_Attack_Occurrence)) +
  geom_histogram(bins = 30, alpha = 0.7, position = "dodge") +
  ggtitle("Age Distribution by Heart_Attack_Occurrence") +
  xlab("Age") + ylab("Count")
```

### 2.1.2 Distribution and relationships involving Gender

```{r}
ggplot(heart_data, aes(x = Gender, fill = Heart_Attack_Occurrence)) +
  geom_bar(alpha = 0.7) +
  ggtitle("Gender Distribution by Heart_Attack_Occurrence") +
  xlab("Gender") + ylab("Count")
```

### 2.1.3 Distribution and relationships involving Region

```{r}
ggplot(heart_data, aes(x = Gender, fill = Heart_Attack_Occurrence)) +
  geom_bar(position = "fill") +
  facet_wrap(~ Region) +  # Check across different age groups
  labs(title = "Heart Attack Occurrence by Gender and Region")
```

## 2.2 Reviewing the dataset to understand Health Metrics Variables

Health metrics are key indicators that can help identify an individual's heart attack, including Cholesterol_level,Stress_levels, BMI, Heart_Rate, Systolic_BP, Diastolic_BP. These metrics are measurable factors related to a person's overall health and lifestyle. When certain health metrics are not in an ideal range, they can contribute to the development of heart disease, which in turn increases the risk of a heart attack.

### 2.2.1 Measure Cholesterol_level variable

```{r}
ggplot(heart_data, aes(x = Age, y = Cholesterol_Level)) +
  geom_point(aes(color = Heart_Attack_Occurrence)) +
  ggtitle("Cholesterol_Level vs Age for Heart_Attack_Occurrence") +
  xlab("Age") + ylab("Cholesterol_Level")
```

Discover the distribution of Heart_Attack_Occurrence == "Yes" based on Cholesterol Level. I use the dplyr package in R to group the data and the ggplot2 package to draw a histogram.

```{r}
library(dplyr)
heart_attack_yes <- heart_data %>%
  filter(Heart_Attack_Occurrence == "Yes")

ggplot(heart_attack_yes, aes(x = Cholesterol_Level)) +
  geom_histogram(binwidth = 10, fill = "grey", color = "black", alpha = 0.7) +
  labs(
    title = "Distribution of Cholesterol Level for Heart Attack Occurrence",
    x = "Cholesterol Level (mg/dL)",
    y = "Frequency"
  ) +
  theme_classic()
```

Mapping the probabilities directly onto colour and colour the ridgeline plot by quantile. We can compute the median of Cholesterol_Level for people who had a heart attack.

```{r}

heart_attack_yes$Age_Binned <- cut(heart_attack_yes$Age, 
                                   breaks = seq(10, 80, by = 10),  
                                   labels = c("10-20","20-30","30-40","40-50", "50-60", "60-70", "70-80"),
                                   right = FALSE)  

ggplot(heart_attack_yes,
       aes(x = Cholesterol_Level, 
           y = Age_Binned, 
           fill = factor(stat(quantile))
           )) +
  stat_density_ridges(
    geom = "density_ridges_gradient",
    calc_ecdf = TRUE, 
    quantiles = 4,
    quantile_lines = TRUE) +
  scale_fill_viridis_d(name = "Quartiles") +
  theme_classic()
```

To analyze Cholesterol_Level by age among individuals who had a heart attack, I look at the relationship between age and cholesterol level for people in the heart attack group. Code chunk below shows an advanced way to customize tooltip. A function is used to compute 90% confident interval of the mean. The derived statistics are then displayed in the tooltip.

```{r}
tooltip <- function(y, ymax, accuracy = .01) {
  mean <- scales::number(y, accuracy = accuracy)
  sem <- scales::number(ymax - y, accuracy = accuracy)
  paste("Mean Cholesterol_Level:", mean, "+/-", sem)
}

gg_point <- ggplot(data=heart_attack_yes, 
                   aes(x = Age),
) +
  stat_summary(aes(y = Cholesterol_Level, 
                   tooltip = after_stat(  
                     tooltip(y, ymax))),  
    fun.data = "mean_se", 
    geom = GeomInteractiveCol,  
    fill = "light blue"
  ) +
  stat_summary(aes(y = Cholesterol_Level),
    fun.data = mean_se,
    geom = "errorbar", width = 0.8, size = 0.2
  )

girafe(ggobj = gg_point,
       width_svg = 8,
       height_svg = 8*0.618)
```

### 2.2.2 Measure stress level variable

Creating an interactive scatter plot: plot_ly() method to measure stress_level and Heart_Rate together in relation to heart attack occurrence and see how they relate or distribute together.

```{r}
plot_ly(
  data = heart_data, 
  x = ~Stress_Levels, 
  y = ~Heart_Rate, 
  color = ~Heart_Attack_Occurrence)
```

### 2.2.3 Measure Heart_Rate variable

Creating a scatter plot with a marginal distribution (boxplot) to visualize the relationship between Heart Rate and Cholesterol Level and calculate the median of Heart Rate and Cholesterol Level for all observations.

```{r}
p1 <- ggplot(data=heart_data, 
            aes(x= Cholesterol_Level, 
                y= Heart_Rate, 
                color=Heart_Attack_Occurrence)) +
  geom_point() +
  coord_cartesian(xlim=c(90,320),
                  ylim=c(30,110))

ggMarginal(p1, type = "boxplot",
           groupColour = TRUE, 
           groupFill = TRUE)
```

### 2.2.4 Measure Blood pressure (Systolic_BP and Diastolic_BP) variable

```{r}
p2 <- ggplot(data=heart_data, aes(x = Heart_Attack_Occurrence, y = Systolic_BP , color = Heart_Attack_Occurrence)) +
  geom_jitter() +
  labs(
    title = "Systolic Blood Pressure",
    x = "Heart Attack Occurrence",
    y = "Systolic Blood Pressure (mmHg)"
  ) +
  theme_classic()

p3 <- ggplot(data=heart_data, aes(x = Heart_Attack_Occurrence, y = Diastolic_BP , color = Heart_Attack_Occurrence)) +
  geom_jitter() +
  labs(
    title = "Diastolic Blood Pressure",
    x = "Heart Attack Occurrence",
    y = "Diastolic Blood Pressure (mmHg)"
  ) +
  theme_classic()

p4 <- ggplot(data=heart_attack_yes, 
             aes(x= Systolic_BP, 
                 y= Diastolic_BP)) +
  geom_point() +
  geom_smooth(method=lm, 
              size=0.5) +  
  coord_cartesian(xlim=c(60,170),
                  ylim=c(40,115)) +
  ggtitle("Systolic_BP and Diastolic_BP for Heart_Attack ")

(p2 / p3) | p4
```

Observation: Based on the plot, there is no clear linear relationship between Blood Pressure and heart attack

## 2.3 Reviewing the dataset to understand Other health conditions Variables

### 2.3.1 Measure Smoking_History variable

To review the dataset and understand the Other Health Conditions Variables such as Smoking History, Diabetes History, Hypertension History, and Family History in relation to heart attack occurrence, it will help us understand the distributions, relationships, and any potential impact these variables have on the occurrence of heart attacks.

```{r}
ggplot(heart_data, aes(x = Smoking_History, fill = Heart_Attack_Occurrence)) +
  geom_bar(position = "fill") +
  labs(title = "Smoking History by Heart Attack Occurrence", x = "Smoking History", y = "Proportion") +
  scale_fill_manual(values = c("lightblue", "pink")) +
  theme_classic()
```

Observation: Based on the bar chart, proportion of Heart_Attack_Occurrence for smokers and non-smokers is almost the same. It suggests that smoking may not have a clear or strong direct association with heart attack occurrence in the dataset

### 2.3.2 Measure Smoking_History and Alcohol_Consumption variable

```{r}
ggplot(heart_data, aes(x = Hypertension_History, fill = Heart_Attack_Occurrence)) +
  geom_bar(position = "fill") +
  facet_wrap(~ Family_History) +  # Check across different age groups
  labs(title = "Heart Attack Occurrence by Smoking History and Alcohol_Consumption")
```

Observation: Combining Smoking History and Alcohol Consumption doesn't reveal a clear relationship with Heart Attack Occurrence.

### 2.3.3 Measure BMI variable

calculate the probability of having a heart attack within certain BMI ranges

```{r}
ggplot(heart_attack_yes,
       aes(x = BMI, 
           y = Age_Binned, 
           fill = factor(stat(quantile))
           )) +
  stat_density_ridges(
    geom = "density_ridges_gradient",
    calc_ecdf = TRUE, 
    quantiles = c(0.025, 0.975)
    ) +
  scale_fill_manual(
    name = "Probability",
    values = c("#FF0000A0", "#A0A0A0A0", "#0000FFA0"),
    labels = c("(0, 0.025]", "(0.025, 0.975]", "(0.975, 1]")
  ) +
  theme_ridges()
```

### 2.3.3 Measure Hypertension_History variable

